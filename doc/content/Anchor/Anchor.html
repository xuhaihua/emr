<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../../css/style.css">
        <script src="../../js/lib/flexible.js"></script>
        <title>
            EMR文档
        </title>
        <script>
            function toLink(link, linkStorage) {
                localStorage.setItem("currentChild", linkStorage);
                event.stopPropagation();
                window.location.href = link;
            }
        </script>
    </head>
    <body style="overflow-y: scroll;height: 100%;">
        <div class="content-right-frame">
            <div class="h-30"></div>

            <!--概述-->
            <div class="mb-10">
                <h1>
                    Anchor (锚)
                </h1>
                <p class="fs-16">
                    锚在空间内用于定义它是空间内的一个点该点的坐标以比例（Scale）表示【例如：(0.5,0,5,0,5)表示节点左上角顶点的坐标]】，锚的标签名称为Anchor
                </p>

                <div class="result mt-25">
                    <div>
                        <img src="../../img/ex27.png" alt="" />
                    </div>
                </div>
            </div>

            <div class="tip custom-block">
                <p class="custom-block-title pd-0 color-black font-bold mt-0">
                    <span class="infoTitle">
                        <span>
                            <img src="../../img/info.png" alt="" />
                        </span>
                        <label>说明：</label>
                    </span>
                </p>
                <p>
                    锚的坐标单位不是毫米是Scale（比例）,例如：锚（0.5,0.5,0.5）如果它在某一父节点下那它代表的是它左上角的一个点，如果它不在任何节点下那它代表的是世界坐标系（500mm,500mm,500mm）这一点
                </p>
            </div>

            <h3 class="mt-30">
                <ul class="ml-25">
                    <li>锚的属性</li>
                </ul>
            </h3>
            <h4 style="border-left:4px solid #999; padding-left: .1852rem;">
                视图属性：<span style="font-weight: normal;">（这些属性可用于视图文档中的标签上）</span>
            </h4>
            <div class="table-border">
                <table cellspacing="0" class="table bb-1 bt-1">
                    <tr class="tableHead">
                        <td class="name" style="width: 20%;">名称</td>
                        <td style="width: 20%;">说明</td>
                        <td style="width: 10%">数据类型</td>
                        <td style="width: 30%;">备注</td>
                    </tr>

                    <tr>
                        <td class="font-bold">name</td>
                        <td>锚的名称</td>
                        <td>string</td>
                        <td>组件内唯一</td>
                    </tr>

                    <tr>
                        <td class="font-bold">x</td>
                        <td>锚的x坐标</td>
                        <td>float?</td>
                        <td>如果值为null并且存在target，那么它的值为target的坐标</td>
                    </tr>

                    <tr>
                        <td class="font-bold">y</td>
                        <td>锚的y坐标</td>
                        <td>float?</td>
                        <td>如果值为null并且存在target，那么它的值为target的坐标</td>
                    </tr>

                    <tr>
                        <td class="font-bold">z</td>
                        <td>锚的z坐标</td>
                        <td>float?</td>
                        <td>如果值为null并且存在target，那么它的值为target的坐标</td>
                    </tr>

                    <tr>
                        <td class="font-bold">radius</td>
                        <td>锚的radius半径（感兴趣范围）</td>
                        <td>float</td>
                        <td>单位m （米）</td>
                    </tr>
                    
                    <tr>
                        <td class="font-bold">targetId</td>
                        <td>锚的目标元素Id</td>
                        <td>string</td>
                        <td>作为锚的目标元素会自动对齐到该锚的位置</td>
                    </tr>

                    <tr>
                        <td class="font-bold">interestId</td>
                        <td>感兴趣Id</td>
                        <td>string</td>
                        <td>被锚标记为感兴趣元素在进入它的感兴趣范围后会触发锚的相应事件（例如：onAnchorNodeHover、onAnchorNodeOut等等）</td>
                    </tr>
                    
                    <tr>
                        <td class="font-bold">intersetName</td>
                        <td>感兴趣name （将指定name的元素标记为该锚的感兴情节点）</td>
                        <td>string</td>
                        <td>被锚标记为感兴趣元素在进入它的感兴趣范围后会触发锚的相应事件（例如：onAnchorNodeHover、onAnchorNodeOut等等）</td>
                    </tr>

                    <tr>
                        <td class="font-bold">intersetHand</td>
                        <td>感兴趣手，可选的值有：<span class="font-bold">none</span> | <span class="font-bold">left</span> | <span class="font-bold">right</span> | <span class="font-bold">both</span></td>
                        <td>string enum</td>
                        <td>被锚标记为感兴趣手的手指进入它的感兴趣范围后会触发锚的相应事件（例如：onAnchorNodeHover、onAnchorNodeOut等等）</td>
                    </tr>

                    <tr>
                        <td class="font-bold">intersetHandPointer</td>
                        <td>感兴趣手部指针，可选的值有：<span class="font-bold">none</span> | <span class="font-bold">left</span> | <span class="font-bold">right</span> | <span class="font-bold">both</span></td>
                        <td>string enum</td>
                        <td>被锚标记为感兴趣手的手部指针进入它的感兴趣范围后会触发锚的相应事件（例如：onAnchorNodeHover、onAnchorNodeOut等等）</td>
                    </tr>
                    
                </table>
            </div>

            <h4 class="mt-25 mb-10" style="border-left:4px solid #999; padding-left: .1852rem;">
                逻辑属性：<span style="font-weight: normal;">（这些属性一般用于代码中）</span>
            </h4>
            <div class="table-border">
                <table cellspacing="0" class="table bb-1 bt-1">
                    <tr class="tableHead">
                        <td class="name" style="width: 20%;">名称</td>
                        <td style="width: 20%;">说明</td>
                        <td style="width: 10%">数据类型</td>
                        <td style="width: 30%;">备注</td>
                    </tr>

                    <tr>
                        <td class="font-bold">target</td>
                        <td>target</td>
                        <td>Node</td>
                        <td>锚的当前目标</td>
                    </tr>

                    <tr>
                        <td class="font-bold">intersetNodeList</td>
                        <td>锚的感兴趣列表</td>
                        <td>List&lt;Node></td>
                        <td>通过interestId、intersetName属性被锚标记为感兴趣的节点列表</td>
                    </tr>
                </table>
            </div>


            <h3 class="mt-25">
                <ul>
                    <li class="ml-25">在节点上添加、获取、移除锚的方法</li>
                </ul>
            </h3>
            <p class="fs-16">
                注意：下表列出的方法在节点上
            </p>
            <div class="table-border">
                <table cellspacing="0" class="table bb-1 bt-1">
                    <tr class="tableHead">
                        <td class="name" style="width: 40%;">名称</td>
                        <td >说明</td>
                    </tr>
                    <tr>
                        <td><span class="tag">void</span> <span class="font-bold w-200">addAnchor</span>  (<span class="tag">string</span> name, <span class="tag">Anchor</span> anchor)</td>
                        <td>向节点添加一个锚，其中参数name为：锚的名称，anchor为：要添加的锚</td>
                    </tr>

                    <tr>
                        <td><span class="genericity">List</span>&lt;Anchor> <span class="font-bold w-200">getAnchorList</span> ()</td>
                        <td>获取节点上所有锚</td>
                    </tr>

                    <tr>
                        <td><span class="tag">Anchor</span> <span class="font-bold w-200">getAnchor</span> (<span class="tag">string</span> name)</td>
                        <td>获取节点上的锚，其中参数，name为：要获取的锚的名称</td>
                    </tr>

                    <tr>
                        <td><span class="tag">void</span> <span class="font-bold w-200">removeAnchor</span> (<span class="tag">string</span> name)</td>
                        <td>移除节点上指定的锚，其中参数，name为：要移除的锚的名称</td>
                    </tr>
                </table>
            </div>



            <h3 class="mt-30">
                <ul>
                    <li class="ml-25">锚的事件</li>
                </ul>
            </h3>

            <div>
                <div class="table-border">
                    <div class="table-subTitle">
                        <div>
                            <span></span>
                            <label>节点相关的事件</label>
                        </div>
                    </div>
                    <table cellspacing="0" class="table bb-1 bt-1">
                        <tr class="tableHead">
                            <td style="width:25%">名称</td>
                            <td style="width:20%;">事件委托</td>
                            <td>说明</td>
                        </tr>
                        <tr>
                            <td class="font-bold">onAnchorNodeHover</td>
                            <td>UnityEngine.Events.UnityAction&lt;<span class="link" onclick="toLink('./struct/AnchorNodeHoverEventData.html', './content/Anchor/struct/AnchorNodeHoverEventData.html')">AnchorNodeHoverEventData</span>></td>
                            <td>趣兴趣的节点进入锚的范围内时触发的事件</td>
                        </tr>

                        <tr>
                            <td class="font-bold">onDown</td>
                            <td>UnityEngine.Events.UnityAction&lt;<span class="link" onclick="toLink('./struct/AnchorNodeOutEventData.html', './content/Anchor/struct/AnchorNodeOutEventData.html')">AnchorNodeOutEventData</span>></td>
                            <td>趣兴趣的节点离开锚的感兴趣范围内时触发的事件</td>
                        </tr>
                    </table>

                    <div class="table-subTitle">
                        <div>
                            <span></span>
                            <label>手指相关的事件</label>
                        </div>
                    </div>
                    <table cellspacing="0" class="table bb-1 bt-1">
                        <tr class="tableHead">
                            <td style="width:25%">名称</td>
                            <td style="width:20%;">事件委托</td>
                            <td>说明</td>
                        </tr>
                        <tr>
                            <td class="font-bold">onAnchorJointHover</td>
                            <td>UnityEngine.Events.UnityAction&lt;<span class="link" onclick="toLink('./struct/AnchorJointHoverEventData.html', './content/Anchor/struct/AnchorJointHoverEventData.html')">AnchorJointHoverEventData</span>></td>
                            <td>感兴趣手的手指进入锚的范围内时触发的事件</td>
                        </tr>

                        <tr>
                            <td class="font-bold">onAnchorJointOut</td>
                            <td>UnityEngine.Events.UnityAction&lt;<span class="link" onclick="toLink('./struct/AnchorJointOutEventData.html', './content/Anchor/struct/AnchorJointOutEventData.html')">AnchorJointOutEventData</span>></td>
                            <td>感兴趣手的手指离开锚的感兴趣范围内时触发的事件</td>
                        </tr>
                    </table>

                    <div class="table-subTitle">
                        <div>
                            <span></span>
                            <label>手指相关的事件</label>
                        </div>
                    </div>
                    <table cellspacing="0" class="table bb-1 bt-1">
                        <tr class="tableHead">
                            <td style="width:25%">名称</td>
                            <td style="width:20%;">事件委托</td>
                            <td>说明</td>
                        </tr>
                        <tr>
                            <td class="font-bold">onAnchorPointerHover</td>
                            <td>UnityEngine.Events.UnityAction&lt;<span class="link" onclick="toLink('./struct/AnchorPointerHoverEventData.html', './content/Anchor/struct/AnchorPointerHoverEventData.html')">AnchorPointerHoverEventData</span>></td>
                            <td>感兴趣手的手部射线进入锚的范围内时触发的事件</td>
                        </tr>

                        <tr>
                            <td class="font-bold">AnchorPointerOutEvent</td>
                            <td>UnityEngine.Events.UnityAction&lt;<span class="link" onclick="toLink('./struct/AnchorPointerOutEventData.html', './content/Anchor/struct/AnchorPointerOutEventData.html')">AnchorPointerOutEventData</span>></td>
                            <td>感兴趣手的手部射线离开锚的感兴趣范围内时触发的事件</td>
                        </tr>
                    </table>
                </div>
            </div>

            <h3 class="mt-30">
                Example：
            </h3>
            <p class="fs-16">
                以下代码使用锚点将茶杯定位到托盘之上，当用户通过手部射线或抓取的方法将茶杯拖动到锚点附近（锚点的感兴趣范围内）时，松开操纵的手此时茶杯将自动吸附到托盘之上
            </p>
            <h4 style="border-left:4px solid #999; padding-left: .1852rem;">
                视图文档代码：
            </h4>
            <div>
                <code>
                    <pre style="margin: 0px; padding: 0px;" >
<span>&lt;</span><label>Root</label><span>&gt;</span>
    <sub>&lt;!--创建一个空间节点并在该节点内加载一个托盘NPC--&gt;</sub>
    <span>&lt;</span><label>SpaceNode <span>
        id="tray"
        x="0"
        y="0"
        z="300"
        width="300"
        height="50"
        depth="300"
        npcPath="sources/model/Tray/Prefab/tray"
        lightIntensity="0"
        hoverColor="0,0,255"
        borderWidth="1"
        renderMode="additive"
        backgroundColor="0,0,0"
    >

        <sub>&lt;!--创建一个锚点，该锚点位于托盘表面之上，将cup元素设置为感兴趣节点（被设置为感兴趣元素靠近锚时会触发相应的锚事件例如：onAnchorNodeHover、onAnchorNodeOut等）--&gt;</sub>
        <span>&lt;</span><label>Anchor<span> name="anchor_1" interestId="cup" x="0" y="0.6" z="0" radius="0.025" onAnchorNodeHover="anchorNodeHoverHandle" onAnchorNodeOut="anchorNodeOutHandle" /<span>&gt;</span>
    <span>&lt;</span><span style="color:#F07178;">/SpaceNode</span><span>&gt;</span>

    <sub>&lt;!--创建一个空间节点并在该节点内加载一个茶杯NPC--&gt;</sub>
    <span>&lt;</span><label>SpaceNode<span> id="cup" name="cup" onUp="upHandle" collider="true" x="500" y="150" z="300" width="80" height="100" depth="80" npcPath="sources/model/Cup/Prefab/Mug" renderMode="additive" backgroundColor="0,0,0" enableManipulator="true" /<span>&gt;</span>
<span>&lt;</span><span style="color:#F07178;">/Root</span><span>&gt;</span>
</pre>
                </code>
            </div>

            <h4 style="border-left:4px solid #999; padding-left: .1852rem; margin-top: .2778rem;">
                处理逻辑：
            </h4>
            <code>
                <pre style="margin: 0px; padding: 0px;">
<span class="commentary">// 是否进入锚的感兴趣范围</span>
<span class="tag">private bool</span> isInAnchor = <span class="tag">false</span>;

<span class="commentary">// 当前感兴趣节点</span>
<span class="tag">private</span> <span class="genericity">Node</span> interestNode = <span class="tag">null</span>;

<span class="commentary">// 锚的节点悬浮事件处理程序</span>
<span class="tag">public</span> <span class="adorn">void</span> <span class="methodName">anchorNodeHoverHandle</span><span class="block">(</span>AnchorNodeHoverEventData eventData<span class="block">)</span>
<span class="block">{</span>
    <span class="commentary">// 标识茶杯已进入锚的感兴趣范围</span>
    this.isInAnchor = <span class="tag">true</span>;
    interestNode = <span class="adorn">eventData</span>.interestNode;

    <span class="commentary">// 将lightIntensity设置为1，显示托盘节点四周的边框</span>
    <span class="tag">var</span> tray = this.<span class="methodName">getNodeById</span>&lt;<span class="genericity">SpaceNode</span>>(<span class="str">"tray"</span>);
    tray.lightIntensity = 1;
<span class="block">}</span>

<span class="commentary">// 锚的节点移出事件处理程序</span>
<span class="tag">public</span> <span class="adorn">void</span> <span class="methodName">anchorNodeOutHandle</span><span class="block">(</span>AnchorNodeOutEventData eventData<span class="block">)</span>
<span class="block">{</span>
    <span class="commentary">// 标识茶杯已移出锚的感兴趣范围</span>
    this.isInAnchor = <span class="tag">false</span>;
    interestNode = <span class="adorn">null</span>;

    <span class="commentary">// 将lightIntensity设置为0，隐藏托盘节点四周的边框</span>
    <span class="tag">var</span> tray = this.<span class="methodName">getNodeById</span>&lt;<span class="genericity">SpaceNode</span>>(<span class="str">"tray"</span>);
    tray.lightIntensity = 0;
<span class="block">}</span>

<span class="commentary">// 节点的onUp事件处理程序</span>
<span class="tag">public</span> <span class="adorn">void</span> <span class="methodName">upHandle</span><span class="block">(</span>UpEventData eventData<span class="block">)</span>
<span class="block">{</span>
    <span class="commentary">// 获取托盘节点上的锚</span>
    <span class="tag">var</span> tray = this.<span class="methodName">getNodeById</span>&lt;<span class="genericity">SpaceNode</span>>(<span class="str">"tray"</span>);
    <span class="tag">var</span> anchor_1 = tray.<span class="methodName">getAnchor</span>(<span class="str">"anchor_1"</span>);

    <span class="commentary">// 设置锚的目标节点为当前感兴趣节点</span>
    anchor_1.target = interestNode;
    
    <span class="commentary">// 将节点对齐到锚</span>
    anchor_1.<span class="methodName">alignment</span>();

    <span class="commentary">// 通过将lightIntensity设置为0隐藏托盘四周的边框</span>
    tray.lightIntensity = 0;
<span class="block">}</span>
</pre>
            </code>

            <div class="result mt-25 v7">
                <div>
                    <video src="../../img/v7.mp4" muted="muted" autoplay="autoplay" loop></video>
                </div>
            </div>

            <div class="tip custom-block">
                <p class="custom-block-title pd-0 color-black font-bold mt-0">
                    <span class="infoTitle">
                        <span>
                            <img src="../../img/info.png" alt="" />
                        </span>
                        <label>MRTK 锚：</label>
                    </span>
                </p>
                <p>
                    MRTK中也有一个锚它比起这里的EMR锚更高级，在应用中按实际情况两者可以结合使用
                </p>
            </div>
        </div>
        
        <div class="h-30"></div>
    </body>
</html>